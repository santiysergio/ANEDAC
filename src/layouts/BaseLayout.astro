---
import BaseHead from '@/components/BaseHead'
import Header from '@/components/Header'
import ProviderTheme from '@/components/ProviderTheme'
import ProviderAnimations from '@/components/ProviderAnimations'
import TwSizeIndicator from '@/components/TwSizeIndicator'
import EditBlog from '@/components/editBlog'
import '../styles/fonts.css'

const { title, description, image, articleDate } = Astro.props
const defaultImage = '/open-graph.png'
const imageUrl = new URL(image || defaultImage, Astro.site).href
---

<html lang='es' class='scroll-smooth'>
	<head>
		<BaseHead title={title} description={description} ogImage={image} articleDate={articleDate} />

		<meta property='og:type' content='website' />
		<meta property='og:url' content={Astro.url} />
		<meta property='og:title' content={title} />
		<meta property='og:description' content={description} />
		<meta property='og:image' content={imageUrl} />
		<meta property='twitter:card' content='summary_large_image' />
		<meta property='twitter:url' content={Astro.url} />
		<meta property='twitter:title' content={title} />
		<meta property='twitter:description' content={description} />
		<meta property='twitter:image' content={imageUrl} />

		<ProviderTheme />
		<ProviderAnimations />
		<link rel='icon' href='/favicon.png' type='image/png' />

		<!-- Bloque de Google Analytics y Lógica de Consentimiento -->
		<script async src={`https://www.googletagmanager.com/gtag/js?id=G-L3RENW6576`}></script>
		<script is:inline>
			// Configuración básica de Google Analytics
			window.dataLayer = window.dataLayer || []
			function gtag() {
				// ¡LA CORRECCIÓN ESTÁ AQUÍ! Usamos 'arguments' directamente.
				dataLayer.push(arguments)
			}
			gtag('js', new Date())

			// Establecer el Modo de Consentimiento por defecto a 'denied'
			gtag('consent', 'default', {
				ad_storage: 'denied',
				analytics_storage: 'denied',
				ad_user_data: 'denied',
				ad_personalization: 'denied'
			})

			// Configuración inicial de tu ID de GA
			gtag('config', 'G-L3RENW6576')

			// Lógica del banner de cookies
			document.addEventListener('DOMContentLoaded', () => {
				const banner = document.getElementById('cookie-consent-banner')
				const acceptBtn = document.getElementById('accept-cookies')
				const rejectBtn = document.getElementById('reject-cookies')
				const manageBtn = document.getElementById('manage-cookies-btn')

				if (banner && acceptBtn && rejectBtn) {
					const showBanner = () => {
						banner.style.display = 'flex'
						setTimeout(() => (banner.style.transform = 'translateY(0)'), 10)
					}
					const hideBanner = () => (banner.style.transform = 'translateY(100%)')

					const consent = localStorage.getItem('cookie_consent')
					if (!consent) {
						showBanner()
					}

					acceptBtn.addEventListener('click', () => {
						gtag('consent', 'update', {
							analytics_storage: 'granted',
							ad_storage: 'granted'
						})
						localStorage.setItem('cookie_consent', 'accepted')
						hideBanner()
					})

					rejectBtn.addEventListener('click', () => {
						localStorage.setItem('cookie_consent', 'rejected')
						hideBanner()
					})

					if (manageBtn) {
						manageBtn.addEventListener('click', (event) => {
							event.preventDefault()
							localStorage.removeItem('cookie_consent')
							showBanner()
						})
					}
				}
			})
		</script>
	</head>

	<body class='bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white'>
		<main
			class='px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible'
		>
			<Header />
			<slot />
		</main>
		<TwSizeIndicator />
		<EditBlog />

		<footer class='text-center py-8 text-sm text-gray-500 dark:text-gray-400'>
			<div class='flex justify-center items-center flex-wrap gap-x-6 gap-y-2 mb-4'>
				<a href='/post/aviso-legal/' class='underline hover:text-gray-800 dark:hover:text-gray-200'
					>Aviso Legal</a
				>
				<a
					href='/post/politica-de-privacidad/'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'>Política de Privacidad</a
				>
				<a
					href='/post/poltica-de-cookies/'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'>Política de Cookies</a
				>
			</div>
			<p>&copy; {new Date().getFullYear()} ANEDAC. Todos los derechos reservados.</p>
			<div class='mt-2'>
				<a
					href='#'
					id='manage-cookies-btn'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'
				>
					Gestionar Preferencias de Cookies
				</a>
			</div>
		</footer>

		<!-- HTML del Banner de Cookies -->
		<div
			id='cookie-consent-banner'
			style='display: none; position: fixed; bottom: 0; left: 0; width: 100%; background-color: #2c3e50; color: #ecf0f1; padding: 20px; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); justify-content: space-between; align-items: center; z-index: 1000; transition: transform 0.4s ease-out; transform: translateY(100%);'
		>
			<p style='margin: 0; font-size: 14px; flex-grow: 1;'>
				Utilizamos cookies para mejorar tu experiencia. Al continuar, aceptas nuestro uso de
				cookies.
				<a href='/post/poltica-de-cookies/' style='color: #3498db; text-decoration: underline;'
					>Más información</a
				>.
			</p>
			<div style='display: flex; gap: 10px; margin-left: 20px;'>
				<button
					id='accept-cookies'
					style='padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background-color: #27ae60; color: white;'
					>Aceptar</button
				>
				<button
					id='reject-cookies'
					style='padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background-color: #7f8c8d; color: white;'
					>Rechazar</button
				>
			</div>
		</div>

		<style is:global>
			/* Pequeño CSS global para la responsividad del banner en móvil */
			@media (max-width: 768px) {
				#cookie-consent-banner {
					flex-direction: column;
					text-align: center;
				}
				#cookie-consent-banner > div {
					margin-left: 0;
					margin-top: 15px;
					width: 100%;
					justify-content: center;
				}
			}
		</style>
	</body>
</html>
