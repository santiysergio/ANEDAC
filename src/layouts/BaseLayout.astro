---
import CookieConsent from '@/components/CookieConsent'
import BaseHead from '@/components/BaseHead'
import Header from '@/components/Header'
import ProviderTheme from '@/components/ProviderTheme'
import ProviderAnimations from '@/components/ProviderAnimations'
import TwSizeIndicator from '@/components/TwSizeIndicator'
import EditBlog from '@/components/editBlog'

const { title, description, image, articleDate } = Astro.props
const defaultImage = '/open-graph.png'
const imageUrl = new URL(image || defaultImage, Astro.site).href
---

<html lang='es' class='scroll-smooth'>
	<head>
		<BaseHead title={title} description={description} ogImage={image} articleDate={articleDate} />

		<meta property='og:type' content='website' />
		<meta property='og:url' content={Astro.url} />
		<meta property='og:title' content={title} />
		<meta property='og:description' content={description} />
		<meta property='og:image' content={imageUrl} />
		<meta property='twitter:card' content='summary_large_image' />
		<meta property='twitter:url' content={Astro.url} />
		<meta property='twitter:title' content={title} />
		<meta property='twitter:description' content={description} />
		<meta property='twitter:image' content={imageUrl} />

		<ProviderTheme />
		<ProviderAnimations />
		<link rel='icon' href='/favicon.png' type='image/png' />

		<script
			type='text/partytown'
			async
			src={`https://www.googletagmanager.com/gtag/js?id=G-L3RENW6576`}></script>
		<script is:inline>
			window.dataLayer = window.dataLayer || []
			function gtag() {
				dataLayer.push(arguments)
			}
			gtag('js', new Date())
			gtag('consent', 'default', {
				ad_storage: 'denied',
				analytics_storage: 'denied',
				ad_user_data: 'denied',
				ad_personalization: 'denied'
			})
			gtag('config', 'G-L3RENW6576')
		</script>
	</head>

	<body class='bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white'>
		<main
			class='px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible'
		>
			<Header />
			<slot />
		</main>
		<TwSizeIndicator />
		<EditBlog />

		<footer class='text-center py-8 text-sm text-gray-500 dark:text-gray-400'>
			<div class='flex justify-center items-center flex-wrap gap-x-6 gap-y-2 mb-4'>
				<a href='/post/aviso-legal/' class='underline hover:text-gray-800 dark:hover:text-gray-200'
					>Aviso Legal</a
				>
				<a
					href='/post/politica-de-privacidad/'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'>Política de Privacidad</a
				>
				<a
					href='/post/poltica-de-cookies/'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'>Política de Cookies</a
				>
			</div>

			<p>&copy; {new Date().getFullYear()} ANEDAC. Todos los derechos reservados.</p>

			<div class='mt-2'>
				<a
					href='#'
					id='manage-cookies-btn'
					class='underline hover:text-gray-800 dark:hover:text-gray-200'
				>
					Gestionar Preferencias de Cookies
				</a>
			</div>
		</footer>

		<CookieConsent client:load />

		<script>
			const manageCookiesBtn = document.getElementById('manage-cookies-btn')
			if (manageCookiesBtn) {
				manageCookiesBtn.addEventListener('click', (event) => {
					event.preventDefault()
					localStorage.removeItem('cookie_consent')
					const banner = document.getElementById('cookie-consent-banner')
					if (banner) {
						banner.classList.add('show')
					} else {
						location.reload()
					}
				})
			}
		</script>

		<style>
			body {
				margin-left: calc(100vw - 100%);
			}
		</style>
	</body>
</html>
